---
title: "GAM_Covid"
author: "Mathilde Le Vu"
date:  "`r Sys.Date()`"
html_document: 
output:
  rmdformats::robobook:
    code_folding: show
    self_contained: true
    highlight: pygments
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```
# Birthweight
## Effect of having delivery date during the pandemic (wave 1 or 2)
Data: all births 2015-2021

```{r}
m_BW_bam_covid<- bam(BW ~ s(GA_weeks) +  s(mat_age) + s(birth_Y_M_num) + s(month, bs="cc") + s(mean_ssep2) + s(mean_Alt_mean2)  +parity_cat + sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_first_wave + COVID_second_wave, data=bevn_eco_in7_15_21) 
summary(m_BW_bam_covid)
gam.check(m_BW_bam_covid) 

  plot(m_BW_bam_covid, select=1, ylim=c(0, 4000),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid)[1]) # GA weeks
  plot(m_BW_bam_covid, select=2, ylim=c(3200, 3400),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid)[1]) #maternal age
  plot(m_BW_bam_covid, select=3, ylim=c(3300, 3380),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid)[1],  xlab  = "100: 2015-04,    120: 2016-12, 140: 2018-08, 160: 2020-04, 180 : 2021-12")
  plot(m_BW_bam_covid, select=4, ylim=c(3340, 3380),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid)[1]) # month
  plot(m_BW_bam_covid, select=5, ylim=c(3200, 3400),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid)[1]) #ssep
    plot(m_BW_bam_covid, select=6, ylim=c(3100, 3500),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid)[1]) #altitude
    
  beta <- coef(m_BW_bam_covid)
  Vb <- vcov(m_BW_bam_covid, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  n <- 585024
  d <- (abs(beta)/(sqrt(n)*se))
  my.ci <- data.frame(cbind(beta, lci = beta-1.96*se, uci = beta + 1.96*se, d))
  round(head(my.ci,17), 2)
```

## Effect of being exposed during each specific trimester
Data: all births 2015-2021

### First-trimester exposure to COVID
```{r}
m_BW_bam_covid_1st_trimester <- bam(BW ~ s(GA_weeks) +  s(mat_age) + s(birth_Y_M_num) + s(month, bs="cc") + s(mean_ssep2) + s(mean_Alt_mean2)+ parity_cat + sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_first_trimester, data=bevn_eco_in7_15_21) 
summary(m_BW_bam_covid_1st_trimester)

gam.check(m_BW_bam_covid_1st_trimester) 
  
  plot(m_BW_bam_covid_1st_trimester, select=1, ylim=c(0, 4000),shade = TRUE, shade.col = "lightblue",  shift =  coef(m_BW_bam_covid_1st_trimester)[1]) # GA weeks
  plot(m_BW_bam_covid_1st_trimester, select=2, ylim=c(3200, 3400),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_1st_trimester)[1]) #maternal age
  plot(m_BW_bam_covid_1st_trimester, select=3, ylim=c(3300, 3380),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_1st_trimester)[1],  xlab  = "100: 2015-04,    120: 2016-12, 140: 2018-08, 160: 2020-04, 180 : 2021-12")
  plot(m_BW_bam_covid_1st_trimester, select=4, ylim=c(3340, 3380),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_1st_trimester)[1]) # month
  plot(m_BW_bam_covid_1st_trimester, select=5, ylim=c(3200, 3400),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_1st_trimester)[1]) #ssep
  plot(m_BW_bam_covid_1st_trimester, select=6, ylim=c(3100, 3500),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_1st_trimester)[1]) #altitude
    
  beta <- coef(m_BW_bam_covid_1st_trimester)
  Vb <- vcov(m_BW_bam_covid_1st_trimester, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  n <- 585024
  d <- (abs(beta)/(sqrt(n)*se))
  my.ci <- data.frame(cbind(beta, lci = beta-1.96*se, uci = beta + 1.96*se, d))
  round(head(my.ci,16), 2)
```

### VLBW exposure to COVID during 1st trimester
```{r}
m_VLBW_bam_covid_1st_trimester <- bam(VLBW~ s(GA_weeks) + s(mat_age) + s(birth_Y_M_num) + s(month, bs="cc") + s(mean_ssep2) + s(mean_Alt_mean2)+ parity_cat + sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_first_trimester, family="binomial", data=bevn_eco_in7_15_21) 

 summary(m_VLBW_bam_covid_1st_trimester)
  
  plot(m_VLBW_bam_covid_1st_trimester, trans = plogis, select=1, shift = coef(m_VLBW_bam_covid_1st_trimester)[1], shade = TRUE, shade.col = "lightblue") #GA weeks
  plot(m_VLBW_bam_covid_1st_trimester, trans = plogis, select=2, ylim=c(0, 0.06), shift = coef(m_VLBW_bam_covid_1st_trimester)[1], shade = TRUE, shade.col = "lightblue") #mat age
  plot(m_VLBW_bam_covid_1st_trimester, trans = plogis, select=3, ylim=c(0.0, 0.0001), shift = coef(m_VLBW_bam_covid_1st_trimester)[1], shade = TRUE, shade.col = "lightblue") #time
  plot(m_VLBW_bam_covid_1st_trimester, trans = plogis, select=4, ylim=c(0.0, 0.4), shift = coef(m_VLBW_bam_covid_1st_trimester)[1], shade = TRUE, shade.col = "lightblue") #month
  plot(m_VLBW_bam_covid_1st_trimester, trans = plogis, select=5, ylim=c(0.0005, 0.025), shift = coef(m_VLBW_bam_covid_1st_trimester)[1], shade = TRUE, shade.col = "lightblue") #ssep
  plot(m_VLBW_bam_covid_1st_trimester, trans = plogis, select=6, ylim=c(0.0005, 0.025), shift = coef(m_VLBW_bam_covid_1st_trimester)[1], shade = TRUE, shade.col = "lightblue") #altitude
  
#table to show OR, confidence interval and Cohen's d
  OR <- exp(coef(m_VLBW_bam_covid_1st_trimester))
  beta <- coef(m_VLBW_bam_covid_1st_trimester)
  Vb <- vcov(m_VLBW_bam_covid_1st_trimester, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  lci <- exp(beta-1.96*se)
  uci <- exp(beta+1.96*se)
  d <- abs(beta)/1.81
  my.ci <- data.frame(cbind(OR, lci, uci, d))
  round(head(my.ci, 16), 2)  
```

### Second-trimester exposure to COVID
```{r}
m_BW_bam_covid_2nd_trimester <- bam(BW ~ s(GA_weeks) +  s(mat_age) + s(birth_Y_M_num) + s(month, bs="cc") + s(mean_ssep2) + s(mean_Alt_mean2)+ parity_cat + sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_second_trimester, data=bevn_eco_in7_15_21) 
summary(m_BW_bam_covid_2nd_trimester)

gam.check(m_BW_bam_covid_2nd_trimester) 
  
  plot(m_BW_bam_covid_2nd_trimester, select=1, ylim=c(0, 4000),shade = TRUE, shade.col = "lightblue",  shift =  coef(m_BW_bam_covid_2nd_trimester)[1]) # GA weeks
  plot(m_BW_bam_covid_2nd_trimester, select=2, ylim=c(3200, 3400),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_2nd_trimester)[1]) #maternal age
  plot(m_BW_bam_covid_2nd_trimester, select=3, ylim=c(3300, 3380),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_2nd_trimester)[1],  xlab  = "100: 2015-04,    120: 2016-12, 140: 2018-08, 160: 2020-04, 180 : 2021-12")
  plot(m_BW_bam_covid_2nd_trimester, select=4, ylim=c(3340, 3380),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_2nd_trimester)[1]) # month
  plot(m_BW_bam_covid_2nd_trimester, select=5, ylim=c(3200, 3400),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_2nd_trimester)[1]) #ssep
  plot(m_BW_bam_covid_2nd_trimester, select=6, ylim=c(3100, 3500),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_2nd_trimester)[1]) #altitude
    
  beta <- coef(m_BW_bam_covid_2nd_trimester)
  Vb <- vcov(m_BW_bam_covid_2nd_trimester, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  n <- 585024
  d <- (abs(beta)/(sqrt(n)*se))
  my.ci <- data.frame(cbind(beta, lci = beta-1.96*se, uci = beta + 1.96*se, d))
  round(head(my.ci,16), 2)
```

### VLBW exposure to COVID during 2nd trimester
```{r}
m_VLBW_bam_covid_2nd_trimester <- bam(VLBW~ s(GA_weeks) + s(mat_age) + s(birth_Y_M_num) + s(month, bs="cc") + s(mean_ssep2) + s(mean_Alt_mean2)+ parity_cat + sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_second_trimester, family="binomial", data=bevn_eco_in7_15_21) 

 summary(m_VLBW_bam_covid_2nd_trimester)
  
  plot(m_VLBW_bam_covid_2nd_trimester, trans = plogis, select=1, shift = coef(m_VLBW_bam_covid_2nd_trimester)[1], shade = TRUE, shade.col = "lightblue") #GA weeks
  plot(m_VLBW_bam_covid_2nd_trimester, trans = plogis, select=2, ylim=c(0, 0.06), shift = coef(m_VLBW_bam_covid_2nd_trimester)[1], shade = TRUE, shade.col = "lightblue") #mat age
  plot(m_VLBW_bam_covid_2nd_trimester, trans = plogis, select=3, ylim=c(0.0, 0.0001), shift = coef(m_VLBW_bam_covid_2nd_trimester)[1], shade = TRUE, shade.col = "lightblue") #time
  plot(m_VLBW_bam_covid_2nd_trimester, trans = plogis, select=4, ylim=c(0.0, 0.4), shift = coef(m_VLBW_bam_covid_2nd_trimester)[1], shade = TRUE, shade.col = "lightblue") #month
  plot(m_VLBW_bam_covid_2nd_trimester, trans = plogis, select=5, ylim=c(0.0005, 0.025), shift = coef(m_VLBW_bam_covid_2nd_trimester)[1], shade = TRUE, shade.col = "lightblue") #ssep
  plot(m_VLBW_bam_covid_2nd_trimester, trans = plogis, select=6, ylim=c(0.0005, 0.025), shift = coef(m_VLBW_bam_covid_2nd_trimester)[1], shade = TRUE, shade.col = "lightblue") #altitude
  
#table to show OR, confidence interval and Cohen's d
  OR <- exp(coef(m_VLBW_bam_covid_2nd_trimester))
  beta <- coef(m_VLBW_bam_covid_2nd_trimester)
  Vb <- vcov(m_VLBW_bam_covid_2nd_trimester, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  lci <- exp(beta-1.96*se)
  uci <- exp(beta+1.96*se)
  d <- abs(beta)/1.81
  my.ci <- data.frame(cbind(OR, lci, uci, d))
  round(head(my.ci, 16), 2)  
```

### Third-trimester exposure to COVID
```{r}
m_BW_bam_covid_3rd_trimester <- bam(BW ~ s(GA_weeks) +  s(mat_age) + s(birth_Y_M_num) + s(month, bs="cc") + s(mean_ssep2) + s(mean_Alt_mean2)+ parity_cat + sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_third_trimester, data=bevn_eco_in7_15_21) 
summary(m_BW_bam_covid_3rd_trimester)

gam.check(m_BW_bam_covid_3rd_trimester) 
  
  plot(m_BW_bam_covid_3rd_trimester, select=1, ylim=c(0, 4000),shade = TRUE, shade.col = "lightblue",  shift =  coef(m_BW_bam_covid_3rd_trimester)[1]) # GA weeks
  plot(m_BW_bam_covid_3rd_trimester, select=2, ylim=c(3200, 3400),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_3rd_trimester)[1]) #maternal age
  plot(m_BW_bam_covid_3rd_trimester, select=3, ylim=c(3300, 3380),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_3rd_trimester)[1],  xlab  = "100: 2015-04,    120: 2016-12, 140: 2018-08, 160: 2020-04, 180 : 2021-12")
  plot(m_BW_bam_covid_3rd_trimester, select=4, ylim=c(3340, 3380),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_3rd_trimester)[1]) # month
  plot(m_BW_bam_covid_3rd_trimester, select=5, ylim=c(3200, 3400),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_3rd_trimester)[1]) #ssep
  plot(m_BW_bam_covid_3rd_trimester, select=6, ylim=c(3100, 3500),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_3rd_trimester)[1]) #altitude
    
  beta <- coef(m_BW_bam_covid_3rd_trimester)
  Vb <- vcov(m_BW_bam_covid_3rd_trimester, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  n <- 585024
  d <- (abs(beta)/(sqrt(n)*se))
  my.ci <- data.frame(cbind(beta, lci = beta-1.96*se, uci = beta + 1.96*se, d))
  round(head(my.ci,16), 2)
```

### VLBW exposure to COVID during 3rd trimester
```{r}
m_VLBW_bam_covid_3rd_trimester <- bam(VLBW~ s(GA_weeks) + s(mat_age) + s(birth_Y_M_num) + s(month, bs="cc") + s(mean_ssep2) + s(mean_Alt_mean2)+ parity_cat + sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_third_trimester, family="binomial", data=bevn_eco_in7_15_21) 

 summary(m_VLBW_bam_covid_3rd_trimester)
  
  plot(m_VLBW_bam_covid_3rd_trimester, trans = plogis, select=1, shift = coef(m_VLBW_bam_covid_3rd_trimester)[1], shade = TRUE, shade.col = "lightblue") #GA weeks
  plot(m_VLBW_bam_covid_3rd_trimester, trans = plogis, select=2, ylim=c(0, 0.06), shift = coef(m_VLBW_bam_covid_3rd_trimester)[1], shade = TRUE, shade.col = "lightblue") #mat age
  plot(m_VLBW_bam_covid_3rd_trimester, trans = plogis, select=3, ylim=c(0.0, 0.0001), shift = coef(m_VLBW_bam_covid_3rd_trimester)[1], shade = TRUE, shade.col = "lightblue") #time
  plot(m_VLBW_bam_covid_3rd_trimester, trans = plogis, select=4, ylim=c(0.0, 0.4), shift = coef(m_VLBW_bam_covid_3rd_trimester)[1], shade = TRUE, shade.col = "lightblue") #month
  plot(m_VLBW_bam_covid_3rd_trimester, trans = plogis, select=5, ylim=c(0.0005, 0.025), shift = coef(m_VLBW_bam_covid_3rd_trimester)[1], shade = TRUE, shade.col = "lightblue") #ssep
  plot(m_VLBW_bam_covid_3rd_trimester, trans = plogis, select=6, ylim=c(0.0005, 0.025), shift = coef(m_VLBW_bam_covid_3rd_trimester)[1], shade = TRUE, shade.col = "lightblue") #altitude
  
#table to show OR, confidence interval and Cohen's d
  OR <- exp(coef(m_VLBW_bam_covid_3rd_trimester))
  beta <- coef(m_VLBW_bam_covid_3rd_trimester)
  Vb <- vcov(m_VLBW_bam_covid_3rd_trimester, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  lci <- exp(beta-1.96*se)
  uci <- exp(beta+1.96*se)
  d <- abs(beta)/1.81
  my.ci <- data.frame(cbind(OR, lci, uci, d))
  round(head(my.ci, 16), 2)  
```

## Effect of being exposed to COVID during two trimesters (1+3) vs  one trimester only.
Data: only COVID cases (so 2020-21). Not month and time variables-
```{r}
m_BW_bam_covid_two_trimesters <- bam(BW ~ s(GA_weeks) +  s(mat_age) + s(mean_ssep2) + s(mean_Alt_mean2)+ parity_cat + sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + COVID_two_trimesters, data=bevn_eco_in7_COVID_exp_during_pregnancy) 
summary(m_BW_bam_covid_two_trimesters)

gam.check(m_BW_bam_covid_two_trimesters) 
  
  plot(m_BW_bam_covid_two_trimesters, select=1, ylim=c(0, 4100),shade = TRUE, shade.col = "lightblue",  shift =  coef(m_BW_bam_covid_two_trimesters)[1]) # GA weeks
  plot(m_BW_bam_covid_two_trimesters, select=2, ylim=c(3300, 3450),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_two_trimesters)[1]) #maternal age
  plot(m_BW_bam_covid_two_trimesters, select=3, ylim=c(3100, 3400),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_two_trimesters)[1]) #ssep
    plot(m_BW_bam_covid_two_trimesters, select=4, ylim=c(3100, 3400),shade = TRUE, shade.col = "lightblue",  shift = coef(m_BW_bam_covid_two_trimesters)[1]) #altitude
    
  beta <- coef(m_BW_bam_covid_two_trimesters)
  Vb <- vcov(m_BW_bam_covid_two_trimesters, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  n <- 127888
  d <- (abs(beta)/(sqrt(n)*se))
  my.ci <- data.frame(cbind(beta, lci = beta-1.96*se, uci = beta + 1.96*se, d))
  round(head(my.ci,15), 2)
```

# Stillbirth

## Effect of having delivery date during the pandemic (wave 1 or 2)
Data: all births 2015-2021

```{r}
m_SB_bam_covid <- bam(stillbirth ~ s(GA_weeks) +  s(mean_Alt_mean2) + mat_age + birth_Y_M_num + month + mean_ssep2 +  sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_first_wave + COVID_second_wave, family="binomial", data=bevn_eco_in6_15_21) 

  summary(m_SB_bam_covid)
  plot(m_SB_bam_covid, trans = plogis, select=1, shade = TRUE, shade.col = "lightblue",  shift = coef(m_SB_bam_covid)[1]) # GA weeks
  plot(m_SB_bam_covid, trans = plogis, select=2, ylim=c(0, 0.002), shade = TRUE, shade.col = "lightblue",  shift = coef(m_SB_bam_covid)[1]) #altitude
    
  OR <- exp(coef(m_SB_bam_covid))
  beta <- coef(m_SB_bam_covid)
  Vb <- vcov(m_SB_bam_covid, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  lci <- exp(beta-1.96*se)
  uci <- exp(beta+1.96*se)
  d <- abs(beta)/1.81
  my.ci <- data.frame(cbind(OR, lci, uci, d))
  round(head(my.ci, 18), 2)
```

Maternal age as linear term. 
Time variables (birth_Y_M_num), maternal age, month and mean ssep variable were put as linear terms, because the model including them as smoothed terms showed that the relationship between these and stillbirth was linear.

## Effect of being infected during each specific trimester
Data: all births 2015-2021

### First-trimester exposure to COVID
```{r}
m_SB_bam_covid_1st_trimester <- bam(stillbirth ~ s(GA_weeks) +  s(birth_Y_M_num) + s(mean_Alt_mean2) + mat_age + month + mean_ssep2 +  sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_first_trimester, family="binomial", data=bevn_eco_in6_15_21) 
summary(m_SB_bam_covid_1st_trimester)

gam.check(m_SB_bam_covid_1st_trimester) 
  
  plot(m_SB_bam_covid_1st_trimester, trans = plogis, select=1, shade = TRUE, shade.col = "lightblue",  shift =  coef(m_SB_bam_covid_1st_trimester)[1]) # GA weeks
  plot(m_SB_bam_covid_1st_trimester, trans = plogis, select=2, shade = TRUE, shade.col = "lightblue",  shift = coef(m_SB_bam_covid_1st_trimester)[1], ylim=c(0, 0.002),  xlab  = "100: 2015-04,    120: 2016-12, 140: 2018-08, 160: 2020-04, 180 : 2021-12")
  plot(m_SB_bam_covid_1st_trimester, trans = plogis, select=3, ylim=c(0, 0.002), shade = TRUE, shade.col = "lightblue",  shift = coef(m_SB_bam_covid_1st_trimester)[1]) #altitude
    
  OR <- exp(coef(m_SB_bam_covid_1st_trimester))
  beta <- coef(m_SB_bam_covid_1st_trimester)
  Vb <- vcov(m_SB_bam_covid_1st_trimester, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  lci <- exp(beta-1.96*se)
  uci <- exp(beta+1.96*se)
  d <- abs(beta)/1.81
  my.ci <- data.frame(cbind(OR, lci, uci, d))
  round(head(my.ci, 16), 2)
```

### Second-trimester exposure to COVID
```{r}
m_SB_bam_covid_2nd_trimester <- bam(stillbirth ~ s(GA_weeks) +  s(birth_Y_M_num) + s(mean_Alt_mean2) +  mat_age + month + mean_ssep2 + sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_second_trimester, family="binomial", data=bevn_eco_in6_15_21) 
summary(m_SB_bam_covid_2nd_trimester)

gam.check(m_SB_bam_covid_2nd_trimester) 
  
  plot(m_SB_bam_covid_2nd_trimester, trans = plogis, select=1, shade = TRUE, shade.col = "lightblue",  shift =  coef(m_SB_bam_covid_2nd_trimester)[1]) # GA weeks
  plot(m_SB_bam_covid_2nd_trimester, trans = plogis, select=2, shade = TRUE, shade.col = "lightblue",  shift = coef(m_SB_bam_covid_2nd_trimester)[1],  ylim=c(0, 0.002), xlab  = "100: 2015-04,    120: 2016-12, 140: 2018-08, 160: 2020-04, 180 : 2021-12")
  plot(m_SB_bam_covid_2nd_trimester, trans = plogis, ylim=c(0, 0.002), select=3, shade = TRUE, shade.col = "lightblue",  shift = coef(m_SB_bam_covid_2nd_trimester)[1]) #altitude
    
  OR <- exp(coef(m_SB_bam_covid_2nd_trimester))
  beta <- coef(m_SB_bam_covid_2nd_trimester)
  Vb <- vcov(m_SB_bam_covid_2nd_trimester, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  lci <- exp(beta-1.96*se)
  uci <- exp(beta+1.96*se)
  d <- abs(beta)/1.81
  my.ci <- data.frame(cbind(OR, lci, uci, d))
  round(head(my.ci, 16), 2)
```

### Third-trimester exposure to COVID
```{r}
m_SB_bam_covid_3rd_trimester <- bam(stillbirth ~ s(GA_weeks) +  s(birth_Y_M_num) + s(mean_Alt_mean2) + month + mat_age + mean_ssep2 +  sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + HW + COVID_third_trimester, family="binomial", data=bevn_eco_in6_15_21) 
summary(m_SB_bam_covid_3rd_trimester)

gam.check(m_SB_bam_covid_3rd_trimester) 
  
  plot(m_SB_bam_covid_3rd_trimester, trans = plogis, select=1, shade = TRUE, shade.col = "lightblue",  shift =  coef(m_SB_bam_covid_3rd_trimester)[1]) # GA weeks
  plot(m_SB_bam_covid_3rd_trimester, trans = plogis, select=2, shade = TRUE, shade.col = "lightblue",  shift = coef(m_SB_bam_covid_3rd_trimester)[1],  ylim=c(0, 0.002), xlab  = "100: 2015-04,    120: 2016-12, 140: 2018-08, 160: 2020-04, 180 : 2021-12")
  plot(m_SB_bam_covid_3rd_trimester, trans = plogis, select=3, ylim=c(0, 0.002), shade = TRUE, shade.col = "lightblue",  shift = coef(m_SB_bam_covid_3rd_trimester)[1]) #altitude
    
  OR <- exp(coef(m_SB_bam_covid_3rd_trimester))
  beta <- coef(m_SB_bam_covid_3rd_trimester)
  Vb <- vcov(m_SB_bam_covid_3rd_trimester, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  lci <- exp(beta-1.96*se)
  uci <- exp(beta+1.96*se)
  d <- abs(beta)/1.81
  my.ci <- data.frame(cbind(OR, lci, uci, d))
  round(head(my.ci, 16), 2)
```


## Effect of being exposed to COVID during two trimesters (1+3) vs  one trimester only.
Data: only COVID cases (so 2020-21). Not month and time variables-
```{r}
m_SB_bam_covid_two_trimesters <- bam(stillbirth ~ s(GA_weeks) +  s(mean_Alt_mean2)+  mat_age + mean_ssep2 +  sex + Urban3 + Language + mother_nationality_cat2 + civil_status3 + COVID_two_trimesters, family="binomial", data=bevn_eco_in6_COVID_exp_during_pregnancy) 
summary(m_SB_bam_covid_two_trimesters)

gam.check(m_SB_bam_covid_two_trimesters) 
  
  plot(m_SB_bam_covid_two_trimesters, trans = plogis, select=1, shade = TRUE, shade.col = "lightblue",  shift =  coef(m_SB_bam_covid_two_trimesters)[1]) # GA weeks
  plot(m_SB_bam_covid_two_trimesters, trans = plogis, select=2, ylim=c(0, 0.005), shade = TRUE, shade.col = "lightblue",  shift = coef(m_SB_bam_covid_two_trimesters)[1]) #altitude
    
  OR <- exp(coef(m_SB_bam_covid_two_trimesters))
  beta <- coef(m_SB_bam_covid_two_trimesters)
  Vb <- vcov(m_SB_bam_covid_two_trimesters, unconditional = TRUE)
  se <- sqrt(diag(Vb))
  lci <- exp(beta-1.96*se)
  uci <- exp(beta+1.96*se)
  d <- abs(beta)/1.81
  my.ci <- data.frame(cbind(OR, lci, uci, d))
  round(head(my.ci, 14), 2)
```

