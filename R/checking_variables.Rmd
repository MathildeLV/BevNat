---
title: "Variables checking"
author: "Mathilde Le Vu"
date: '2022-05-11'
output: html_document
---

```{r setup, include=FALSE}
.libPaths(c("H:/Documents/R/win-library/4.1","C:/Program Files/R/R-4.1.2/library"))
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(dplyr)
```

# Opening the data file
```{r }
bevn <- read.csv2(here("data", "birth_iem.csv"))

```
# Checking each variable has the correct format and content

## Statistikjahr und Ereignisjahr = statistical year and year of birth

Expected Ereignisjahr: from 1987 to 2020, no missing
```{r}
summary(bevn$Statistikjahr)
table(bevn$Statistikjahr, useNA="always")
round(prop.table(table(bevn$Statistikjahr, useNA="always"))*100,2)
summary(bevn$Ereignisjahr)
table(bevn$Ereignisjahr, useNA="always")
round(prop.table(table(bevn$Ereignisjahr, useNA="always"))*100,2)
```

##  Ereignismonat = month of birth

Expected: 1-12
```{r}
summary(bevn$Ereignismonat)
table(bevn$Ereignismonat, useNA="always")
round(prop.table(table(bevn$Ereignismonat, useNA="always"))*100,2)
```
<br>

## Mutter und Vater: Alter in erfüllten Jahren: Age mother/father (fullfilled years)

expected? 10-65 for women and 10-90+ for men?
```{r}
summary(bevn$Mutter..Alter.in.erfüllten.Jahren)
summary(bevn$Vater..Alter.in.erfüllten.Jahren)
```
<br>

## Kind: Geschlecht = sex of the neonate <br>

1=male, 2=female 
```{r}
table(bevn$Kind..Geschlecht, useNA="always")
round(prop.table(table(bevn$Kind..Geschlecht, useNA="always"))*100,2)
```

## Kind: Gestationsalter = gestational age 

in Tagen days, missing=empty, only since 2006 <br>
Expected: 100-308?<br>
Checking that its available since 2006
```{r}
summary(bevn$Kind..Gestationsalter.in.Tagen)

#calculating mean by year
aggregate(x = bevn$Kind..Gestationsalter.in.Tagen,      #function aggregate doesnt work          
          by = list(bevn$Ereignisjahr),              
          FUN = mean)                           

 group_mean <- aggregate(Kind..Gestationsalter.in.Tagen ~ Ereignisjahr, data = bevn, mean) # Equivalent works
 group_mean

tapply(bevn$Kind..Gestationsalter.in.Tagen, bevn$Ereignisjahr, summary)

```
Available in 2003 and 2004 as well<br>
Much less NAs from 2007 <br>

## Geburtsort = place of birth (hospital or at home)

Only available until 1997 (ca. 98% in hospitals) <br>
Coding <br>
 1- im Spital	à l’hôpital			1969-1997 <br>
 2- zu Hause	à la maison	1969-1997 <br> 
 3- anderer Ort	autre lieu	1987-1997 <br>
 4- Ort unbekannt	lieu inconnu	1987-1997 <br>
 9- Angabe fehlt	pas d’indication		1987-1997 <br> 

```{r}
table(bevn$Geburtsort, useNA = "always")
round(prop.table(table(bevn$Geburtsort, useNA="always"))*100,2)
table(bevn$Ereignisjahr, bevn$Geburtsort, useNA = "always")
```
Only available until 1997: okay

## Geburtsstaat = State and world region of birth

See separate codebook <br>
Expected: 8100-8703 <br>
```{r}
summary(bevn$Geburtsstaat)
table(bevn$Geburtsstaat, useNA = "always")
```
4 attritbuted to 8999: doesnt correspond to any country in the codebook -> missing Geburtsstaat?  <br>


## Art der Geburt = number of babies 

1=singleton, 2=twins, 3=triplets, ..., 6=sextuplets and more <br>
Expected: 1-6
```{r}
summary(bevn$Art.der.Geburt)
table(bevn$Art.der.Geburt, useNA="always")
round(prop.table(table(bevn$Art.der.Geburt, useNA="always"))*100,2)
```

## Anzahl Knaben and Anzahl Mädchen =	if multiple birth, number of boys and girls

Expected: 0-5 
```{r}
summary(bevn$Anzahl.Knaben)
table(bevn$Anzahl.Knaben, useNA = "always")
summary(bevn$Anzahl.Mädchen)
table(bevn$Anzahl.Mädchen, useNA = "always")
```

## 11. Kind: Grösse in Zentimeter = length at birth (cm), missing=99

Expected: 10-60? And 99 for missing
```{r}
summary(bevn$Kind..Grösse.in.Zentimeter)
table(bevn$Kind..Grösse.in.Zentimeter, useNA = "always")
```
Many are set to 0 (missing? should have been set to 99). Outliers (1-10?)
NA (3) instead of 99

## Kind: Gewicht in Gramm = weight at birth (g), missing=9999 

Expected: 10-6000 and 9999
```{r}
summary(bevn$Kind..Gewicht.in.Gramm)
HBW <- subset(bevn, Kind..Gewicht.in.Gramm>5500) #having a look at high birthweight neonates : 1 extreme outlier at 9351g
table(HBW$Kind..Gewicht.in.Gramm, useNA = "always")
LBW <- subset(bevn, Kind..Gewicht.in.Gramm<500) #having a look at (extreme) low birthweight neonates : many are set to 0, many are also below 100
table(LBW$Kind..Gewicht.in.Gramm, useNA = "always")
```

outliers (BW=9.3kg, or BW <<<100...)<br>
 
## Kind: Rang in der aktuellen Ehe

Expected: 1-15
```{r}
summary(bevn$Kind..Rang.in.der.aktuellen.Ehe)
table(bevn$Kind..Rang.in.der.aktuellen.Ehe, useNA="always")
round(prop.table(table(bevn$Kind..Rang.in.der.aktuellen.Ehe, useNA="always"))*100,2)
```

## Mutter: Staatsangehörigkeit = Nationality Mother, see separate codebook 

Expected: 8100-8703
```{r}
summary(bevn$Mutter..Staatsangehörigkeit)
table(bevn$Mutter..Staatsangehörigkeit, useNA="always")
```
8998, 8999?  NAs?  <br>

## Mutter Zivilstand = additional variable  

See additional codebook <br>
 1 - Single	from 1969 <br>
 2- Married	from 1969 <br>
 3- Widowed	from 1969 <br>
 4- Divorced	from 1969 <br>
 5- Unmarried	from 1998 <br>
 6- Registered partnership from 2007 <br>
 7- Partnership dissolved	from 2007 <br>
```{r}
summary(bevn$Mutter.Zivilstand)
table(bevn$Mutter.Zivilstand, useNA="always")
round(prop.table(table(bevn$Mutter.Zivilstand, useNA="always"))*100,2)
table(bevn$Mutter.Zivilstand, bevn$Ereignisjahr, useNA="always")
```
categories 1, 2, 3 are available in all years (ok) <br>
category 5 available since 1998 (ok) <br>
categroy 6 available since 2006 (1 year earlier) <br>
category 7 available since 2066 (1 year earlier) <br>
 
 
## Mutter: Wohngemeinde / Wohnstaat =  Place of residence Mother

GMDNR or country, see separate codebook <br>
Expected: <br>
1-6910 for commune if resident inside Switz <br>
8201-8703 if resident outside of Switz <br>
```{r}
summary(bevn$Mutter..Wohngemeinde...Wohnstaat)
```
How to check that numbers are okay? see separate codebook <br>
8999, is it missing place of residence? <br>

## Empty variables
- Mutter: Stellung im Beruf (NA) <br>
- Mutter: Beruf (NA) <br>
- Vater/Ernährer: Stellung im Beruf (NA) <br>
- Vater/Ernährer: Beruf (NA) <br>
```{r}
summary(bevn$Mutter..Stellung.im.Beruf)
summary(bevn$Mutter..Beruf)
summary(bevn$Vater.Ernährer..Stellung.im.Beruf)
table(bevn$Vater.Ernährer..Stellung.im.Beruf, useNA="always")
summary(bevn$Vater.Ernährer..Beruf)
```
Vater.Ernährer..Stellung.im.Beruf is not empty: shouldnt it be? <br>
Coding Vater.Ernährer..Stellung.im.Beruf:  <br>
1		indépendant  <br>
2		collaborateur familial  <br>
3		directeur/-trice, fondé(e) de pouvoir, fonctionnaire  ayant une fonction de chef  <br>
4		autre  <br>
9		inconnu  <br>
<br>

## Vater: Staatsangehörigkeit = Nationality father, see separate codebook

Expected: 8100-8703
```{r}
summary(bevn$Vater..Staatsangehörigkeit)
table(bevn$Vater..Staatsangehörigkeit, useNA = "always")
```
Same remark than for the mother: 8998, 899? NAs? to check <br>

## Kind: biologischer Rang
```{r}
summary(bevn$Kind..biologischer.Rang)
table(bevn$Kind..biologischer.Rang, useNA = "always")
round(prop.table(table(bevn$Kind..biologischer.Rang, useNA="always"))*100,2)
```

## Flag variables: what is their use?
```{r}
summary(bevn$Flag..Geschlecht.des.Kindes)
table(bevn$Flag..Geschlecht.des.Kindes, useNA = "always")
summary(bevn$Flag..Art.der.Geburt)
table(bevn$Flag..Art.der.Geburt, useNA = "always")
summary(bevn$Flag..Rang.des.Kindes.in.der.aktuellen.Ehe)
table(bevn$Flag..Rang.des.Kindes.in.der.aktuellen.Ehe, useNA = "always")
summary(bevn$Flag..Zivilstand.der.Mutter)
table(bevn$Flag..Zivilstand.der.Mutter, useNA = "always")
```
Apart form Flag..Zivilstand.der.Mutter, the other variables make no sense --> probably not useful

## Mutter: ständig oder nicht-ständiger Wohnsitz = Residence of the mother

Coding <br>
1=permanent resident, 2=non-permanent resident, 4=short stay, 9=domiciled abroad
```{r}
summary(bevn$Mutter..ständig.oder.nicht.ständiger.Wohnsitz)
table(bevn$Mutter..ständig.oder.nicht.ständiger.Wohnsitz, useNA = "always")
round(prop.table(table(bevn$Mutter..ständig.oder.nicht.ständiger.Wohnsitz, useNA="always"))*100,2)
```

## Vater: Alter in erreichten Jahren = Age father (approximated) and  Mutter: Alter in erreichten Jahren = Age mother (approximated)
```{r}
summary(bevn$Vater..Alter.in.erreichten.Jahren)
table(bevn$Vater..Alter.in.erreichten.Jahren, useNA = "always")
summary(bevn$Mutter..Alter.in.erreichten.Jahren)
table(bevn$Mutter..Alter.in.erreichten.Jahren, useNA = "always")
```

##  lebend geboren oder nicht = born alive or not

1=lifeborn, 2=stillborn
```{r}
table(bevn$lebend.geboren.oder.nicht, useNA = "always")
round(prop.table(table(bevn$lebend.geboren.oder.nicht, useNA="always"))*100,3)
```



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
