---
title: "Homework 3"
author: "Mathilde Le Vu"
date: '2022-05-08'
output: html_document
---

```{r setup, include=FALSE}
.libPaths(c("H:/Documents/R/win-library/4.1","C:/Program Files/R/R-4.1.2/library"))
knitr::opts_chunk$set(echo = TRUE)
library(here)
```

## R Markdown

Loading the data

```{r loading data}
pvals_orig <- read.csv(here("data", "p_values_analysis.csv"))
pvals_orig$food[ is.na(pvals_orig$food)] <- "BREAKFASTSANDWICHFREQ"
```


Task 1

```{r}
##If 10% of the 27,716 performed regressions are quantifying true real associations, it means 
  0.1*27716
  #2771.6 regressions are true associations and
  0.9*27716
  #24944.4 are not true associations
  
   #create matrix
  data <- matrix(c(0.6*2771.6, 0.4*2771.6, 2771.6, 0.05*24944.4, 0.95*24944.4, 24944.4, 2910.18, 24805.82, 27716), ncol=3, nrow=3)
  #specify row and column names of matrix
  rownames(data) <- c("pvalue<0.05", "pvalue>0.05", "total")
  colnames(data) <- c('real effect', 'no real effect', 'total')
  #convert matrix to table
  data <- as.table(data)
  data
  
  #false positive rate
  1662.96/2910.18
```
  
 
The table shows that:

- in 1662.96 cases, we show the association when there is actually one.

- alpha risk of showing an association where there is none means that 1247.22 regressions will show a false positive association

#ANSWER TO TASK 1

The positive predictive value is (1662.96/(1662.96+1247.22))=57.1%. This is really low.



Task 2
How many positive decisions have been taken at the 5% significance level? How many are hypothetically really true under the parameters of Task 1?
Based on tasked 1, 2910 
```{r}
str(subset(pvals_orig, p_values<0.05))
1081*0.5714286
```
1,081 positive decisions have been made at the 5% significance level. 

Based on task 1, only 57.1% of these are true: 618 of these 1081 positive decisions are true



Task 3
Take the association between cat ownership and coffee consumption and fit the corresponding linear model. What is the estimated coefficient for the association and its confidence interval? How do you interpret these values correctly? What do you think about the associated p-value?

Opening the raw Data file and building the model
```{r}
rawData <- read.csv(here("data", "raw_anonymized_data.csv"))
summary(rawData$COFFEEDRINKSFREQ)
str(rawData$cat)
model1 <- lm(rawData$COFFEEDRINKSFREQ ~ rawData$cat)
summary(model1)
exp(coef(summary(model1)))[,"Estimate"]
exp(confint(model1))


```
The estimated coefficient is 6.40: people who have a cat are about 7 times more likely to drink coffee than people who dont have a cat.
The confidence interval is 2.09-19.61: it is rather large whereas the pvalue is very small. (0.00163). This suggests the association between owning a cat and drinking coffee is a false positive result.


Task 4
Going back to the PPV calculation write a function that parameterizes the percentage of true associations, the significance level and the power; and illustrate how the PPV depends on these three characteristics.
```{r}
PPV <- function(trueassoc, alpha, power){
  (power*trueassoc)/(((1-trueassoc)*alpha)+(power*trueassoc))
}

##setting as baseline PPV
PPVbaseline <- PPV(0.20, 0.05, 0.8)
PPVbaseline
##changing the power
power90 <- PPV(0.20, 0.05, 0.9)
power70 <- PPV(0.20, 0.05, 0.7)
power90
power70
```
Changing the power of the study will indeed change the PPV: the more the power increases, the highest rate of PPV we will have.
We can see here that by setting the power to 90% instead of 80%, the PPV slightly increases from 80% (power or 80%), to 82% (power of 90%). Decreasing by 10% the power also lead to PPV reduction, from 80% to 77.8%.
Overall, we can say changing power has a small impact on PPV.


Changing the significance level (ie alpha error)
```{r}
alpha2.5 <- PPV(0.20, 0.025, 0.8)
alpha10 <- PPV(0.20, 0.1, 0.8)
alpha2.5
alpha10
```
Setting the significance level to 2.5% increases the rate of PPV: it goes from 80 to 89%.
Setting the significance level to 10% decreases the rate of PPV: it goes from 80 to 57%.
Alpha is a very important parameter when we design a study.

Changing the percentage of true associations
```{r}
truassoc10 <- PPV(0.10, 0.05, 0.8)
truassoc30 <- PPV(0.30, 0.05, 0.8)
truassoc10
truassoc30
```
Setting the true association percentage to 10% instead of 20% decreases the rate of PPV: it goes from 80 to 64%.
Setting the true association percentage to 30% instead of 20% increases the rate of PPV: it goes from 80 to 82%.
The true association percentage is also an important parameter when we design a study.


To conclude we can say the PPV depends highly on alpha (significance level), the % of true associations, and depends moderately on beta/the power chosen.
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

